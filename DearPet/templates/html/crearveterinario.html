{% extends "html/template.html" %}

{% block title %}Registrar Veterinario{% endblock %}

{% block body %}


<form method="post" class="col-12 cien" onsubmit="return validarFormulario()" autocomplete="off" enctype="multipart/form-data" >
    {% csrf_token %}
    <div class="col-md-7 margin  center row">
        <h1 class="center">Registro Veterinario</h1>
        <div class="mb-3 col-6 ">
            <input type="text" tabindex="1" class="form-control" placeholder="Nombre" name="nombre" id="nombre" pattern="^[a-zA-Z]+$"
                required>
            <input type="text" tabindex="3" placeholder="direccion" name="direccion" class="form-control" id="location-input"
                pattern="^[^<>]*$" required>
            <input hidden type="text" class="form-control" name="nombre_comuna" id="locality-input" />
            <input hidden type="text" class="form-control" name="nombre_region"
                id="administrative_area_level_1-input" />
            <input hidden type="text" class="form-control" name="nombre_pais" id="country-input"
                onchange="formatRut()" required />
            <input type="tel" tabindex="5" class="form-control" name="fono" placeholder="56912345678" id="fono" pattern="^[0-9]+$"
                required>
                <input type="password" tabindex="7" class="form-control" minlength="6" placeholder="Contraseña" name="contrasena"
                id="contrasena" pattern="^[^<>]*$" required>
                <input type="text" tabindex="9" class="form-control" minlength="6" placeholder="cod:Licencia" name="licencia"
                id="licencia" required>
            
        </div>
        <div class="mb-3 col-6 ">
            <input type="text" tabindex="2" class="form-control" placeholder="Primer Apellido" name="primer_apellido"
                id="primer_apellido" pattern="^[a-zA-Z]+$" required>
            <input type="text" tabindex="4" class="form-control" placeholder="RUT/DNI" name="rut" id="rut" pattern="^[^<>]*$"
                oninput="formatRut()" required>
                <input type="email" tabindex="6" class="form-control" placeholder="Email" name="email" id="email"
                pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" required>
           
            <input type="password" tabindex="8" class="form-control" placeholder="Confirmar Contraseña" name="contrasena1"
                id="contrasena1" pattern="^[^<>]*$" required>
            <input type="file" tabindex="10" name="cedula" id="file">
            <label class="form-control" style="text-align: left;" for="file">subir foto cedula de indentidad</label>

        </div>
        <button type="submit" tabindex="11" class="btn btn-dearpet-secundario bformulario">Crear Usuario</button>
    </div>
</form>

<script>
    function validarFormulario() {
        var nombre = document.getElementById("nombre").value;
        var primer_apellido = document.getElementById("primer_apellido").value;
        var rut = document.getElementById("rut").value;
        var fono = document.getElementById("fono").value;
        var contrasena = document.getElementById("contrasena").value;
        var contrasena1 = document.getElementById("contrasena1").value;
        var email = document.getElementById("email").value;
        var nombres = /^[a-zA-Z]+$/;
        var telefono = /^[0-9]+$/;
        var tener = /[a-zA-Z0-9-]+/;
        var notener = /^[^<>]*$/;
        var correo = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

        if (contrasena.length < 6) {
            alert("la contraseña tiene que tener por lo menos 6 caracteres")
            return false;
        }
        if (!nombres.test(nombre)) {
            alert("El nombre debe contener solo letras.");
            return false;
        }
        if (!nombres.test(primer_apellido)) {
            alert("El primer apellido debe contener solo letras.");
            return false;
        }
        if (rut.trim() !== "" && !rut.test(rut)) {
            alert("El rut debe ser valido.");
            return false;
        }
        if (!telefono.test(fono)) {
            alert("El telefono debe ser valido.");
            return false;
        }

        if (!notener.test(contrasena)) {
            alert("La contraseña no debe contener los caracteres '<' o '>'.");
            return false;
        }
        if (!notener.test(contrasena1)) {
            alert("La contraseña no debe contener los caracteres '<' o '>'.");
            return false;
        }
        if (!correo.test(email)) {
            alert("El correo debe ser valido.");
            return false;
        }

        return true;
    }

    function validarRutChile(rut) {
        return /^[0-9]+-[0-9Kk]$/.test(rut);
    }

    function formatRut() {
        var rutInput = document.getElementById("rut");
        var rut = rutInput.value;
        var pais = document.getElementById("country-input").value;

        if (pais === "Chile") {
            // Para RUT chileno, colocar guion antes del último dígito
            rutInput.value = rut.replace(/[^\dKk]/g, '');
            if (rutInput.value.length > 1) {
                rutInput.value = rutInput.value.slice(0, rutInput.value.length - 1) + '-' + rutInput.value.slice(-1);
            }
        } else if (pais === "Argentina") {
            // Para DNI argentino, máximo 8 dígitos sin guiones
            rutInput.value = rut.replace(/[^\d]/g, '').slice(0, 8);
        } else {
            // Otros países, quitar guiones y dejar solo números
            rutInput.value = rut.replace(/[^\d]/g, '');
        }
    }

</script>
{% endblock %}